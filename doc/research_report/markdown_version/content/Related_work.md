# 相关工作——刘时

## 相关工作

本项目作为计算机学院组成原理H班的大作业，完成了使用Rust改写rt-thread国产loT操作系统内核的任务。下面将从本课程之前的Rust改写工作，国内外学术界和工业界的主流成果和本项目的创新点三个角度产开论述。

### 本课程之前的Rust改写工作

1. 2019年    x-rust-freertos小组用Rust改写FreeRTOS（一个实时、嵌入式操作系统）,完成了对FreeRTOS中所有的内核模块——移植（port）模块、链表（list）模块、任务调度（task）模块和队列与信号量模块的改写。
2. 2023年 Phoenix-Flames小组用Rust改写sel4微内核，提供内存安全性和并发安全性。
3. 2024年 mustruct小组用Rust语言重写了FreeRTOS，并在其中引入了MMU支持，以期获得更灵活、安全的内存管理能力。
4. 2024年mkdir小组用Rust语言重写了Linux系统的bpf-trace模块，以期能更安全的监控和分析用户空间的程序行为
5. 2024年Rage_of_dUST小组和RushToLight小组分别用Rust语言改写了HuaWei LiteOS的内存管理单元（MMU）和动态内存管理模块，提升了系统的安全性和稳定性
6. 2024年

### 国内外学术界和工业界对Rust改写基于C的操作系统的讨论

1. **在Linux内核中引入Rust语言。**
    
    近年来，业界对在 Linux 内核中引入 Rust 语言表现出浓厚兴趣，主要目的是利用 Rust 的内存安全特性来提高内核的安全性和稳定性。然而，将 Rust 完全替代 C 来重写整个 Linux 内核的想法并未得到广泛支持。
    
    目前，社区的主要工作集中在将 Rust 引入内核的部分模块，特别是设备驱动程序的开发。2022 年，首批 Rust 代码被合并到 Linux 内核中，标志着这一尝试的开始。此后，开发者们持续推进 Rust 在内核中的应用，例如开发基于 Rust 的设备驱动程序和文件系统模块。
    
    一些核心维护者认为 Rust 的内存安全特性可以减少常见的内存管理错误，提高内核的安全性和可靠性。例如，Linux 内核高级开发者 Greg Kroah-Hartman 曾表示，添加另一种语言并非问题，关键在于项目的长期成功。他强调，使用 Rust 编写新代码可以减少某些类型的错误，给开发者和维护者带来益处。
    
    然而，也有部分维护者对在内核中使用 Rust 持保留态度，担心多语言代码库的维护复杂性和潜在问题。例如，内核维护者 Christoph Hellwig 对将 Rust 代码引入内核表示质疑，认为这可能增加维护负担。 
    
    对此，Linux 之父 Linus Torvalds 也曾发表看法：Linux 最终不会用 Rust 编写，没有人会用 Rust 重写内核的 2500 万行 C，但是他也看到了 Rust 的优势，鼓励采用缓慢但稳定的方法将 Rust 引入 Linux，同时他表示将 Rust 接口用于驱动程序和其他非核心内核程序是有道理的。
    
    总体而言，业界对在 Linux 内核中引入 Rust 持谨慎支持态度，认可其潜在优势，但也关注可能带来的挑战。目前的共识是，在特定模块中试验性地引入 Rust，以评估其实际效果和影响。
    
2. **在Windows内核中引入Rust语言**
    
    微软对在 Windows 内核中引入 Rust 持积极态度，旨在利用 Rust 的内存安全特性减少漏洞，提高系统安全性和性能。然而，微软并未计划全面用 Rust 重写整个 Windows 内核，而是采取逐步迁移的策略。微软 Azure 首席技术官 Mark Russinovich 曾表示，新项目应优先考虑使用 Rust，而非 C/C++。
    
    具体的，微软将 Windows 的文本分析、布局和渲染引擎 DWriteCore 部分重写为 Rust 版本。截至 2023 年，DWriteCore 包含约 15.2 万行 Rust 代码和 9.6 万行 C++ 代码。两名开发人员耗时半年完成了这项工作，改进后的版本已面向开发者发布。同时，微软将 Win32 GDI 的部分组件迁移至 Rust，目前已添加了约 3.6 万行 Rust 代码。这些改进已在最新版本的 Windows 11 中应用，且通过了所有启动测试。
    
3. **其他有关Rust改写的工作**
    
    3.1 Redox [redox-os.org](https://www.redox-os.org/zh/?utm_source=chatgpt.com)
    
    Redox 是一个用 Rust 编程语言编写的类 Unix 微内核操作系统，旨在将 Rust 的创新（安全性、并发性和实用性）引入现代微内核和完整的应用程序生态系统。
    
    该系统采用微内核架构，类似于 MINIX，驱动程序在用户空间运行，增强了系统的安全性和稳定性。此外，Redox 包含可选的图形用户界面 Orbital，支持 Rust 标准库，并以 MIT 许可证开源发布。
    
    Redox的优势主要来源于Rust语言的特性:极高的内存管理安全性，此外，作为一个操作系统，其通过模块化和标准化实现了可拓展性与兼容性，已经能够成为一个实际的成果而非教学用例。但是，其作为新兴操作系统还存在功能不完善，硬件支持有限，稳定性欠佳等问题。
    
    总体而言，Redox 作为一个创新的操作系统项目，展示了 Rust 在系统开发中的潜力。尽管目前存在一些不足，但其在安全性、模块化和兼容性方面的优势，使其有继续发展的潜力。
    
    3.2 TockOS  [https://tockos.org/](https://tockos.org/)
    
    TockOS 是一款专为嵌入式系统设计的开源实时操作系统，采用 Rust 编程语言编写内核，旨在为无线传感器网络节点等资源受限的设备提供安全、高效的运行环境。
    
    TockOS的主要优势同样来自Rust语言的特性：类型安全和内存管理安全。同时作为一个嵌入式操作系统，其优化了低功耗特性，满足了嵌入式设备对能耗的敏感性。同样的，作为一个新兴的操作系统，TockOS支持的硬件十分有限，生态系统还不成熟，同时，Rust语言高昂的学习成本也限制了其广泛使用。
    
    3.3 蓝河操作系统 [https://blueos.vivo.com/system](https://blueos.vivo.com/system)
    
    蓝河操作系统（BlueOS）是 vivo 于 2023 年推出的自研智慧操作系统，采用 Rust 语言编写系统框架，旨在为用户提供更智慧、更流畅、更安全的使用体验。
    
    蓝河操作系统比起上面两个操作系统更加成熟，其借助 AI 大模型能力实现了对多模态交互的支持，包括声音、图片、文字、视频、手势等。同时，其利用Rust的内存安全特性，保障了系统的内存安全和并发安全。但是其仍然有应用兼容性差，生态系统成熟度低等问题。
    
    总体而言，蓝河操作系统在智能交互和安全性方面具有显著优势，但在应用兼容性和生态系统成熟度方面仍需进一步发展。
    

通过以上的讨论，我们可以看出将Rust引入操作系统的维护与开发已经逐渐成为了业界的共识。无论是现在主流的操作系统Linux和Windows都将Rust引入其内核，并将Rust作为未来主流的开发语言，还是越来越多的新兴操作系统选择Rust作为其开发语言，从而在安全性和稳定性上得到更大的提升，都表明了Rust的重要性与前瞻性。

### 本项目的主要创新点

本项目希望能将Rust引入RT-Thread，一款由中国开源社区主导开发的实时物联网操作系统。其创新点主要有以下三点：

1. 相比于Linux和Windows,RT-Thread是一款嵌入式操作系统。而嵌入式操作系统相对而言由于其系统的简单性可能会更容易面临安全性挑战。而是用Rust代替C语言将从源头上解决内存管理的安全性问题。
2. 相比于蓝河操作系统，TockOS与Redox，RT-Thread拥有更成熟的生态环境与更好的兼容性。RT-Thread已经发展了16年，其对市场上主流的硬件架构都有着很好的支持，同时，其对在线软件包管理工具的支持又让其兼具了可拓展性和兼容性。
3. 另外，RT-Thread系统完全开源，遵循 Apache License 2.0 开源许可协议，并且是中国社区主持的拥有完全知识产权的产品。对RT-Thread的开发和完善有助于我国开源社区生态的发展，有助于我国操作系统自主性的实现，具有比较重大的战略意义。